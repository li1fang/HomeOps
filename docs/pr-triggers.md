# docs/pr-triggers.md â€” PR è§¦å‘è¯ï¼ˆv2.1 / è¯æ®ä¼˜å…ˆï¼‰
> **å®—æ—¨**ï¼šä»¥æ ‡å‡†è¯æœ¯é©±åŠ¨ AI æ‰§è¡Œ **Gâ†’R ä¸¤é˜¶æ®µ**ï¼Œé˜²æ­¢â€œå–„æ„è°è¨€â€ã€‚  
> **å¯¹é½**ï¼š`make itest = éƒ¨ç½² + éªŒæ”¶`ï¼ˆGate2 å¤åˆåŠ¨ä½œï¼‰ï¼›`make deploy` ä¸ºåˆå…¥åç”Ÿäº§ä¸Šçº¿ã€‚  
> **æ–°å¢**ï¼šæœ¬ç‰ˆå¼ºåŒ– **Microâ€‘Update ç›®æ ‡ç²¾ç¡®æ€§** ä¸ **è¯Šæ–­æ¨¡å¼çš„è¯´æ˜ä¹‰åŠ¡**ã€‚

---

## ğŸ…¶ é˜¶æ®µ G â€” ç”Ÿæˆ PRï¼ˆç¦æ­¢å¡«å†™ Testing Doneï¼‰

**ç²¾ç®€ç‰ˆï¼ˆé»˜è®¤é¦–é€‰ï¼‰**
```text
Repository: HomeOps
Task: Implement Issue #{ç¼–å·}

ä¸¥æ ¼éµå®ˆæ ¹ç›®å½• AGENTS.md ä¸ docs/verification-spec.mdã€‚
ç°åœ¨åªåšï¼šå®ç°ä¿®å¤å¹¶åˆ›å»º PRã€‚âš ï¸ ç¦æ­¢å¡«å†™ â€œTesting Doneâ€ï¼Œä¿ç•™ä¸º â€œPENDING-CIâ€ã€‚
é‡‘è·¯å¾„ï¼šå…ˆåœ¨æ²™ç®±æœ¬åœ°è·‘é€š Gate1ï¼ˆmake setup â†’ make lint â†’ make testï¼‰ï¼Œå†æäº¤ï¼›
æäº¤åç”± Runner è§¦å‘ Gate2ï¼ˆmake itest = éƒ¨ç½² + éªŒæ”¶ï¼‰ã€‚
```

**è¯¦ç»†ç‰ˆï¼ˆé¦–å•/å¤æ‚åœºæ™¯ï¼‰**
```text
Repository: HomeOps
Task: Implement Issue #{ç¼–å·}

å£å¾„ï¼šAGENTS.mdï¼ˆæµç¨‹ï¼‰ã€verification-specï¼ˆGate2 åˆ¤åˆ†ï¼‰ã€‚
èŒƒå›´ï¼šä»…åš Issue çš„ Requirements/Acceptanceï¼›ä¸æ‰©å±•ã€ä¸é‡æ„ã€ä¸å¼•å…¥æ–°ä¾èµ–ã€‚
Secretsï¼š{yes|no}ï¼ˆä¸ Issue/ codex-meta ä¸€è‡´ï¼›æ•æ„Ÿå­—æ®µä½¿ç”¨ no_log: trueï¼Œä¸å¾—å†™å…¥å·¥ä»¶ï¼‰ã€‚
äº¤ä»˜ï¼šæ•´æ–‡ä»¶æ›¿æ¢å…è®¸ï¼›PR æè¿°å« â€œPENDING-CIâ€ çš„ Testing Done + codex-metaï¼›
æ‰§è¡Œï¼šå…ˆæœ¬åœ°/æ²™ç®±è·‘é€š Gate1ï¼Œå† pushï¼›ç”± Runner è§¦å‘ Gate2ï¼ˆitestï¼‰ã€‚
```

---

## ğŸ… é˜¶æ®µ R â€” CI ç»¿åï¼Œä»…å¼•ç”¨â€œæœ¬æ¬¡ runâ€è¯æ®å›å¡«

```text
Repository: HomeOps
Task: Update PR #{ç¼–å·}

è¯¥ PR çš„ CI å·²å…¨éƒ¨ç»¿ç¯ï¼š{Actions run é“¾æ¥}
ä»…ä»æœ¬æ¬¡ run çš„æ—¥å¿—ä¸ Artifacts æå–äº‹å®ï¼Œå›å¡« PR çš„ â€œTesting Doneâ€ï¼š
- Run URLï¼šè¯¥æ¬¡ Actions run çš„ URLï¼ˆå« run_id/attemptï¼‰
- Commitï¼šHEAD SHA
- Gate1 / Gate2ï¼šJob åç§°ä¸ç»“è®º
- Artifactsï¼šartifacts/test/* ä¸ artifacts/itest/* çš„æ–‡ä»¶æ¸…å•
- è¯æ®ï¼šå…³é”®ä¿¡å·åŸæ–‡ï¼ˆHTTP 200ã€active (running)ã€æŸ¥è¯¢å‘½ä¸­ç­‰ï¼‰+ æ–‡ä»¶å/è·¯å¾„

âš ï¸ ç¦æ­¢æ¨æµ‹æˆ–è™šæ„ï¼›åªèƒ½å¼•ç”¨æœ¬æ¬¡ CI çš„äº‹å®ã€‚
```

---

## ğŸª„ PR â€œå°æ›´æ–°â€è§¦å‘è¯ï¼ˆMicroâ€‘Update / é©³å›é‡å®¡ï¼‰

> ç”¨äº **åŒä¸€ PR** å†…çš„å¢é‡ä¿®æ­£ï¼›ä¸ `docs/pr-micro-update.md` é…å¥—ã€‚

### 1) æ ‡å‡†æ¨¡å¼ï¼ˆä¿®å¤ä¸€ä¸ªæ˜ç¡®ç¼ºå£ï¼‰â€” *æ–°å¢ï¼šç»‘å®š PCR Gap*
```text
Repository: HomeOps
Task: PR Microâ€‘Update for #{PRç¼–å·}

ä¸Šè½® CI è¯æ®ï¼š{ç²˜è´´å¤±è´¥ç‰‡æ®µæˆ–å·¥ä»¶è·¯å¾„}
PCR å¯¹åº”ç¼ºå£ï¼š{ä» PR Close Review çš„ Gap è¡¨é€‰å–/å¼•ç”¨ Spec æ¡æ¬¾ï¼Œå¦‚ Â§D.2 Loki Range Query}
æœ¬è½®ç›®æ ‡ï¼šæäº¤â€œæœ€å°è¡¥ä¸â€ä¿®å¤ä»¥ä¸Šå•ä¸€ç¼ºå£ã€‚ç¦æ­¢æ‰©å±•èŒƒå›´ã€‚

äº¤ä»˜ï¼šä»…ä¿®æ”¹ {å—å½±å“çš„æ–‡ä»¶æ¸…å•}ï¼›ä¿æŒå…¶å®ƒè¡Œä¸ºä¸å˜ã€‚
éªŒæ”¶ï¼š
- Gate1ï¼šmake setup / make lint / make test = 0ï¼›
- Gate2ï¼šé’ˆå¯¹è¯¥ç¼ºå£çš„éªŒè¯è½¬ä¸º OKï¼ˆåˆ—å‡ºå¯¹åº”è¯æ®ä¿¡å·ï¼‰ã€‚
```

### 2) è¯Šæ–­ä¼˜å…ˆæ¨¡å¼ï¼ˆå…ˆæŸ¥æ˜åŸå› ï¼Œå†ä¿®ï¼‰â€” *æ–°å¢ï¼šè¯´æ˜ä¹‰åŠ¡*
```text
Repository: HomeOps
Task: PR Microâ€‘Update (Diagnosisâ€‘First) for #{PRç¼–å·}

ç°è±¡ï¼š{ç²˜è´´åå¸¸/çŸ›ç›¾è¯æ®}
è¯Šæ–­ç›®æ ‡ï¼šè¯·å…ˆåœ¨ PR çš„ **è¯„è®ºæˆ– Commit Message** ä¸­ï¼Œæ˜ç¡®ä½ çš„è¯Šæ–­ç»“è®ºï¼ˆæ˜¯ä»€ä¹ˆ / ä¸ºä»€ä¹ˆ / è¯æ®ï¼‰ã€‚
ä¿®å¤ç›®æ ‡ï¼šåœ¨åŒä¸€ PR æ¨é€â€œæœ€å°è¡¥ä¸â€ï¼Œåªè§£å†³ç»è¯Šæ–­ç¡®è®¤çš„æ ¹å› ã€‚

éªŒæ”¶ï¼š
- CI å…è®¸çº¢ç¯ï¼Œä½†å¿…é¡»ï¼š
  1) äº§å‡ºå®šä½æ‰€éœ€çš„æ–°å·¥ä»¶ï¼ˆåˆ—æ–‡ä»¶åï¼‰ï¼›
  2) PR è¯„è®º/Commit Message å†…å«**ç»“æ„åŒ–è¯Šæ–­è¯´æ˜**ï¼ˆâ‰¤10 è¡Œè¦ç‚¹ï¼Œå¼•ç”¨è¯æ®é“¾æ¥/è¡Œå·ï¼‰ï¼›
- è‹¥ä¿®å¤å·²åˆ°ä½ï¼Œåˆ™ Gate2 è¯¥é¡¹è½¬ä¸º OKã€‚
```

### 3) ä¸´æ—¶é™çº§ + å›è¡¥ Issueï¼ˆåŠ¡å®æ¨è¿›ï¼‰
```text
Repository: HomeOps
Task: PR Microâ€‘Update (Temporary Downgrade) for #{PRç¼–å·}

ä¾æ®è¯æ®ï¼š{ç²˜è´´å¯¼è‡´â€œå½“å‰éªŒæ”¶ä¸å¯è¾¾â€çš„å®¢è§‚é™åˆ¶ï¼Œä¾‹å¦‚ç¼ºå°‘æ—¥å¿—æ ‡ç­¾}
è°ƒæ•´ï¼šå°† {åŸä¸¥æ ¼æ–­è¨€} æš‚æ—¶é™ä½ä¸º {å¯è¾¾çš„å¯æœºåˆ¤æ–­è¨€}ï¼›
åŒæ—¶åˆ›å»ºåç»­ Issueï¼ˆå¦‚ V3.8ï¼‰ç”¨äºâ€œæ¢å¤ä¸¥æ ¼æ ‡å‡†â€ã€‚

éªŒæ”¶ï¼š
- æœ¬ PRï¼šä»¥æ–°æ–­è¨€ä¸ºå‡†ï¼ŒGate2 å…¨ç»¿ï¼›
- æ–° Issueï¼šè®°å½•æ¢å¤è·¯å¾„ä¸ä¼˜å…ˆçº§ï¼ˆHigh/Med/Lowï¼‰ã€‚
```

---

## ğŸ§¾ R é˜¶æ®µå›ºå®š â€œTesting Done å››è¡Œâ€è§„èŒƒ

> R é˜¶æ®µä»…å…è®¸**ä»åŒä¸€æ¬¡ CI run** å¤åˆ¶äº‹å®å›å¡«ã€‚

```
Run URL: <https://github.com/<org>/<repo>/actions/runs/<run_id>/attempts/<n>>
Commit: <HEAD-SHA>
Gate1/Gate2: <job åç§°> â€” <ç»“è®º>
Artifacts: 
  - artifacts/test/tools_versions.txt
  - artifacts/itest/grafana-health.json
  - artifacts/itest/loki-query.json
  - ...
```

**åæ¨¡å¼ï¼ˆæ‹’æ”¶ï¼‰ï¼š** æ²¡æœ‰ Run URL/Artifacts çš„å£è¿°æ€»ç»“ï¼›ä¸å®é™… run ä¸ä¸€è‡´ï¼›è·¨ run æ‹¼æ¥è¯æ®ã€‚

---

## ğŸ¤ ä¸å…¶å®ƒ SOP çš„å…³ç³»
- ä¸ **`docs/pr-micro-update.md`**ï¼šä¸Šé¢çš„ Microâ€‘Update è§¦å‘è¯å°±æ˜¯å…¶â€œæ‰§è¡Œè¯æœ¯â€ã€‚
- ä¸ **`docs/pr-close-review.md`**ï¼šMicroâ€‘Update çš„â€œç›®æ ‡/ç¼ºå£â€åº”æ¥æºäº PCR çš„ **Gap è¡¨**ï¼›R é˜¶æ®µå›å¡«å¼•ç”¨ PCRã€‚

---

## ğŸ“Œ æç¤ºï¼ˆå¸¸è§æ˜“é”™ï¼‰
- Secretsï¼šåœ¨ G é˜¶æ®µå³æ˜ç¡® `{yes|no}`ï¼Œå¹¶ä¸ Issue/ codex-meta ä¿æŒä¸€è‡´ï¼›ä»»ä½•ä½¿ç”¨éƒ½éœ€ `no_log: true`ã€‚
- itestï¼šè¿™æ˜¯ **éƒ¨ç½² + éªŒæ”¶** çš„å¤åˆåŠ¨ä½œï¼›ä¸è¦æŠŠâ€œå…ˆéƒ¨ç½²ã€åéªŒæ”¶â€æ‹†æˆä¸¤ä¸ªä¸åŒ PRã€‚

